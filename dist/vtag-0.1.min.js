(function(p){p.vtag={renderers:{}};p.fn.vtag=function(a){var g=a&&a.type||"retro",h=p.vtag.renderers[g];if("function"!=typeof h)return console&&console.log&&console.log("Unknown renderer: "+g),this;this.each(function(){if("function"==typeof this.getContext){for(var g=p(this),l=p.vtag.md5(g.attr("data-tag")||g.text()),m=[],n=0;16>n;n++){var f=l.substring(2*n,2*n+2);m.push(parseInt(f,16))}var g={width:parseInt(g.attr("width")||g.width()),height:parseInt(g.attr("height")||g.height()),hash:l,bytes:m},
r;for(r in a)g[r]=a[r];h.call(this,g)}});return this};p.vtag.md5=function(a){function g(a,b){var c,e,d,f,g;d=a&2147483648;f=b&2147483648;c=a&1073741824;e=b&1073741824;g=(a&1073741823)+(b&1073741823);return c&e?g^2147483648^d^f:c|e?g&1073741824?g^3221225472^d^f:g^1073741824^d^f:g^d^f}function h(a,b,d,c,e,f,h){a=g(a,g(g(b&d|~b&c,e),h));return g(a<<f|a>>>32-f,b)}function k(a,b,d,c,e,f,h){a=g(a,g(g(b&c|d&~c,e),h));return g(a<<f|a>>>32-f,b)}function l(a,b,d,c,e,f,h){a=g(a,g(g(b^d^c,e),h));return g(a<<
f|a>>>32-f,b)}function m(a,b,d,c,e,f,h){a=g(a,g(g(d^(b|~c),e),h));return g(a<<f|a>>>32-f,b)}function n(a){var b="",d="",c;for(c=0;3>=c;c++)d=a>>>8*c&255,d="0"+d.toString(16),b+=d.substr(d.length-2,2);return b}var f=[],p,q,s,t,b,c,e,d;a=function(a){a=a.replace(/\r\n/g,"\n");for(var b="",d=0;d<a.length;d++){var c=a.charCodeAt(d);128>c?b+=String.fromCharCode(c):(127<c&&2048>c?b+=String.fromCharCode(c>>6|192):(b+=String.fromCharCode(c>>12|224),b+=String.fromCharCode(c>>6&63|128)),b+=String.fromCharCode(c&
63|128))}return b}(a);f=function(a){var b,c=a.length;b=c+8;for(var d=16*((b-b%64)/64+1),e=Array(d-1),f=0,g=0;g<c;)b=(g-g%4)/4,f=8*(g%4),e[b]|=a.charCodeAt(g)<<f,g++;b=(g-g%4)/4;e[b]|=128<<8*(g%4);e[d-2]=c<<3;e[d-1]=c>>>29;return e}(a);b=1732584193;c=4023233417;e=2562383102;d=271733878;for(a=0;a<f.length;a+=16)p=b,q=c,s=e,t=d,b=h(b,c,e,d,f[a+0],7,3614090360),d=h(d,b,c,e,f[a+1],12,3905402710),e=h(e,d,b,c,f[a+2],17,606105819),c=h(c,e,d,b,f[a+3],22,3250441966),b=h(b,c,e,d,f[a+4],7,4118548399),d=h(d,b,
c,e,f[a+5],12,1200080426),e=h(e,d,b,c,f[a+6],17,2821735955),c=h(c,e,d,b,f[a+7],22,4249261313),b=h(b,c,e,d,f[a+8],7,1770035416),d=h(d,b,c,e,f[a+9],12,2336552879),e=h(e,d,b,c,f[a+10],17,4294925233),c=h(c,e,d,b,f[a+11],22,2304563134),b=h(b,c,e,d,f[a+12],7,1804603682),d=h(d,b,c,e,f[a+13],12,4254626195),e=h(e,d,b,c,f[a+14],17,2792965006),c=h(c,e,d,b,f[a+15],22,1236535329),b=k(b,c,e,d,f[a+1],5,4129170786),d=k(d,b,c,e,f[a+6],9,3225465664),e=k(e,d,b,c,f[a+11],14,643717713),c=k(c,e,d,b,f[a+0],20,3921069994),
b=k(b,c,e,d,f[a+5],5,3593408605),d=k(d,b,c,e,f[a+10],9,38016083),e=k(e,d,b,c,f[a+15],14,3634488961),c=k(c,e,d,b,f[a+4],20,3889429448),b=k(b,c,e,d,f[a+9],5,568446438),d=k(d,b,c,e,f[a+14],9,3275163606),e=k(e,d,b,c,f[a+3],14,4107603335),c=k(c,e,d,b,f[a+8],20,1163531501),b=k(b,c,e,d,f[a+13],5,2850285829),d=k(d,b,c,e,f[a+2],9,4243563512),e=k(e,d,b,c,f[a+7],14,1735328473),c=k(c,e,d,b,f[a+12],20,2368359562),b=l(b,c,e,d,f[a+5],4,4294588738),d=l(d,b,c,e,f[a+8],11,2272392833),e=l(e,d,b,c,f[a+11],16,1839030562),
c=l(c,e,d,b,f[a+14],23,4259657740),b=l(b,c,e,d,f[a+1],4,2763975236),d=l(d,b,c,e,f[a+4],11,1272893353),e=l(e,d,b,c,f[a+7],16,4139469664),c=l(c,e,d,b,f[a+10],23,3200236656),b=l(b,c,e,d,f[a+13],4,681279174),d=l(d,b,c,e,f[a+0],11,3936430074),e=l(e,d,b,c,f[a+3],16,3572445317),c=l(c,e,d,b,f[a+6],23,76029189),b=l(b,c,e,d,f[a+9],4,3654602809),d=l(d,b,c,e,f[a+12],11,3873151461),e=l(e,d,b,c,f[a+15],16,530742520),c=l(c,e,d,b,f[a+2],23,3299628645),b=m(b,c,e,d,f[a+0],6,4096336452),d=m(d,b,c,e,f[a+7],10,1126891415),
e=m(e,d,b,c,f[a+14],15,2878612391),c=m(c,e,d,b,f[a+5],21,4237533241),b=m(b,c,e,d,f[a+12],6,1700485571),d=m(d,b,c,e,f[a+3],10,2399980690),e=m(e,d,b,c,f[a+10],15,4293915773),c=m(c,e,d,b,f[a+1],21,2240044497),b=m(b,c,e,d,f[a+8],6,1873313359),d=m(d,b,c,e,f[a+15],10,4264355552),e=m(e,d,b,c,f[a+6],15,2734768916),c=m(c,e,d,b,f[a+13],21,1309151649),b=m(b,c,e,d,f[a+4],6,4149444226),d=m(d,b,c,e,f[a+11],10,3174756917),e=m(e,d,b,c,f[a+2],15,718787259),c=m(c,e,d,b,f[a+9],21,3951481745),b=g(b,p),c=g(c,q),e=g(e,
s),d=g(d,t);return(n(b)+n(c)+n(e)+n(d)).toLowerCase()};p.vtag.hsv2rgb=function(a,g,h){var k,l,m;a=Math.max(0,Math.min(360,a));g=Math.max(0,Math.min(100,g));h=Math.max(0,Math.min(100,h));g/=100;h/=100;if(0==g)return k=g=h,[Math.round(255*k),Math.round(255*g),Math.round(255*h)];a/=60;k=Math.floor(a);l=a-k;a=h*(1-g);m=h*(1-g*l);l=h*(1-g*(1-l));switch(k){case 0:k=h;g=l;h=a;break;case 1:k=m;g=h;h=a;break;case 2:k=a;g=h;h=l;break;case 3:k=a;g=m;break;case 4:k=l;g=a;break;default:k=h,g=a,h=m}return[Math.round(255*
k),Math.round(255*g),Math.round(255*h)]};p.vtag.hsv2hex=function(a,g,h){a=p.vtag.hsv2rgb(a,g,h);for(var k in a)g=a[k].toString(16),a[k]=1==g.length?"0"+g:g;return"#"+a.join("")};p.vtag.renderers.retro=function(a){function g(a,b){h.fillStyle=s;h.beginPath();h.rect(a*m,b*m,m,m);h.fill()}var h=this.getContext("2d"),k=a.width,l=a.height,m=(k+l)/16,n,f,r;n=360*a.bytes[0]/255;f=20*a.bytes[1]/255+60;r=25*a.bytes[2]/255+75;var q=p.vtag.hsv2hex(n,f,r);n=360*a.bytes[0]/255;f=40*a.bytes[5]/255;r=20*a.bytes[6]/
255+80;var s=p.vtag.hsv2hex(n,f,r);a.inverse&&(n=q,q=s,s=n);a.transparent||(h.beginPath(),h.rect(0,0,k,l),h.fillStyle=q,h.fill());for(k=0;8>k;k++)l=a.bytes[k]%3,q=a.bytes[k+1]%6,g(l+1,q+1),g(6-l,q+1)}})(jQuery);
